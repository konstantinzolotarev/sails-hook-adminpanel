<% include head %>

<% var idField = adminpanel.configHelper.getIdentifierField(instance.config.model) %>
<% var data = record %>

<div class="horizontal layout">
    <div class="flex">
        <% var actionType = 'edit' %>
        <% include mixin/globalActions %>
    </div>
</div>
<div class="layout">
    <div class="nav-header">
        <a href="<%= instance.uri %>/">
            <button raised class="btn">
                <i class="fas fa-long-arrow-alt-left"></i>
                Вернуться
            </button>
        </a>
        <div class="nav-header-wrap">
            <button class="btn-nav">
                Скрыть
                <i class="far fa-eye-slash"></i>
            </button>
            <button class="btn-nav">
                Удалить
                <i class="far fa-trash-alt"></i>
            </button>
        </div>
    </div>
    <form id="form" action="<%= instance.uri %>/edit/<%= record[idField] %>" method="POST" enctype="multipart/form-data">
        <% Object.keys(fields).forEach(function(key) { %>
            <% var field = fields[key] %>
            <% var value = adminpanel.viewHelper.getFieldValue(key, field, data) %>
            <div class="admin-panel__title"><%= field.config.title %>
                <a href="javascript:void(0)" role="tooltip" aria-haspopup="true" class="tooltip tooltip-md tooltip-top-right">
                    <i class="fas fa-info-circle"></i>
                    <span class="tooltip-content">Действие определяется через вкл\выкл.<input class="tooltip-input" type="checkbox" checked/><br> По умолчанию действие вкл при первом совпадении даты и времени</span>
                </a>
            </div>
            <div class="admin-panel__widget">
                <% include mixin/fieldWidget %>
            </div>
        <% }) %>
        <div>
            <input type="hidden" name="_csrf" value="<%= _csrf %>"/>
        </div>
        <p>
            <button raised class="btn-save" id="submit" onclick="submitForm()">
                сохранить
            </button>
        </p>
    </form>
</div>

<script>
    function submitForm() {
        // Assign JSONEditor value to form textarea
        for (var id in jsonEditor) {
            try {
                var json = jsonEditor[id].get();
                $('#form-' + id).val(JSON.stringify(json));
            } catch (e) {
                alert('JSON is invalid.');
                $('#form-' + id).show().focus().hide();
                jsonEditor[id].focus();
                return false;
            }
        };
        document.getElementById('form').submit();
    }
</script>

<% include footer %>
